version: '3.8'

services:
  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    container_name: vpn-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      # SSL certificates (mount from host or use certbot)
      - ./nginx/certs:/etc/nginx/certs:ro
      # ACME challenge directory for Let's Encrypt
      - ./nginx/html:/var/www/html
      # Logs
      - ./nginx/logs:/var/log/openresty
    extra_hosts:
      # This allows container to reach host's localhost
      - "host.docker.internal:host-gateway"
    environment:
      - TZ=Asia/Kolkata
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://127.0.0.1:8080/health" ]
      interval: 30s
      timeout: 5s
      retries: 3
    networks:
      - vpn-network

networks:
  vpn-network:
    driver: bridge
